

(**SQL활용 - 원격수업)**

**조인 질의문**

**조인의 개념**

- 조인 하나의 SQL 질의문에 의해서 여러 테이블에 저장된 데이터를 한번에 조회할 수 있는 기능
- 두 개 이상의 테이블을 '결합' 한다는 의미



- 조인의 필요성

  - 하나의 SQL 질의문이 하나의 테이블만 검색할 수 있다고 하는 경우

  - Q. 사번이 103인 사원의 부서명을 알고 싶을 때

    1. 사번이 103번인 사원의 부서 번호를 파악함

    2. 해당 부서 번호와 같은 부서 번호를 가지고 부서명을 부서테이블에서 검색함

       → 매우 불편함

       ![20210327_091742](D:\Users\Brandon Jung\Desktop\20210327_091742.png)

- SQL에서 간단한 조인 표기법

  1. FROM 절에 조인에 참여하는 두 테이블을 기록함

     > 콤마(,)로 구분함

  2. WHERE 절에 조인 조건을 기술함

     - Q. 사번이 103인 사원의 부서명을 알고 싶을 때

       - 사원 정보 : EMPLOYEE

       - 부서 정보 : DEPARTMENT

       - 조인 조건

         > EMPLOYEE.DNO = DEPARTMENT.DNO

         ![20210327_092325](D:\Users\Brandon Jung\Desktop\20210327_092325.png)

- 조인문 작성 시 유의사항

  - 컬럼 이름의 모호성

    - 서로 다른 두 테이블의 컬럼(속성) 명이 같을 경우

      > 예) DNO = DNO
      >
      > → DBMS에서 어느 속성이 어느 테이블에 있는 것인지 알 수 없어짐
      >
      > ![20210327_092636](D:\Users\Brandon Jung\Desktop\20210327_092636.png)

    - 해결방법

      - 컬럼 이름 앞에 테이블 이름을 접두사로 사용함

      - 테이블 이름과 컬럼 이름은 점(.)으로 구분함

        > 예) DEPARTMENT.DNO = EMPLOYEE.DNO

  - 테이블 별명

    - 테이블의 이름이 긴 경우 SQL문 작성이 힘듦
      - 테이블 이름 대신 별명 사용이 가능함
      - FROM 절에 테이블 이름 다음에 공백을 두고 별명을 정의함

  - 별명 작성 규칙

    1. 별명은 최대 30자까지 가능함
    2. 하나의 SQL에서 테이블 이름과 별명을 혼용해서 쓸 수 없음
    3. 테이블의 별명은 해당 SQL문에서만 유효함

  - Q. 사번이 103인 사원의 부서명을 알고 싶을 때 (별명 사용)

    ![20210327_093250](D:\Users\Brandon Jung\Desktop\20210327_093250.png)

    - 별명을 정의한 후에는 별명만을 써야함

      ![20210327_093446](D:\Users\Brandon Jung\Desktop\20210327_093446.png)



**다양한 조인들**

- 카디샨 프로덕트 (Cartesian Product : X(곱하기))

  - 두 테이블에 속한 튜플들의 모든 가능한 쌍을 생성함

  - 일반적인 방법

    - FROM 절에 두 개 이상의 테이블명을 기록함

    - WHERE 절에는 조인 조건을 기술하지 아니함

      > 예) SELECT * FROM EMPLOYEE, DEPARTMENT
      >
      > ![20210327_093901](D:\Users\Brandon Jung\Desktop\20210327_093901.png)

- 동등 조인

  - 조인 조건이 "=" 인 경우
  - 조인 조건으로 일반적으로 "="을 많이 씀

- 자연 조인

  - 조인 조건을 명시하지 않고 조인한다고 할 때 두 테이블에 공통으로 나타나는 속성의 동등 조인으로 생각함

  - 동등 조인과 질의 결과의 구조(스키마)가 똑같지는 않음

    - MS-SQL : 자연 조인을 명시적으로 지원하지는 않음

    - Oracle : 자연 조인을 지원하며 FROM 절에 다음과 같이 씀

      > FROM 테이블명 NATURAL JOIN 테이블 명
      >
      > → WHERE절에 조인 조건을 쓰지 않음

- 쎄타 조인

  - 조인 조건으로 <, >, <=, >=, != 등을 쓸 수 있음

  - 일반적인 조인 조건에 대하여 쎄타 조인이라고 함

    > 예) 다른 사원의 봉급 보다 많은 봉급을 받는 사원들의 이름 찾기
    >
    > ![20210327_094511](D:\Users\Brandon Jung\Desktop\20210327_094511.png)

  - 쎄타 조인의 예

    - Q. SALGRADE 테이블에서 각 봉급의 하한과 상한에 따른 등급(Grade)이 정해져 있음

      ![20210327_094641](D:\Users\Brandon Jung\Desktop\20210327_094641.png)

    - Q. 각 사원의 급여에 따라서 SALGRADE를 참조하여 사원의 등급 출력

      - 조인 조건

        > lowsal <= salary and salary <= highsal
        >
        > ![20210327_094822](D:\Users\Brandon Jung\Desktop\20210327_094822.png)
        - SALGRADE의 lowsal과 highsal은 상한과 하한임

        - between 연산자로 변환할 수 있음 

          ![20210327_095108](D:\Users\Brandon Jung\Desktop\20210327_095108.png)

- 셀프 조인

  - 하나의 테이블 내에 있는 컬럼끼리 연관시켜 조인이 필요한 경우

  - Q. 각 사원의 이름과 그 사원의 관리자 이름 검색

    ![20210327_095441](D:\Users\Brandon Jung\Desktop\20210327_095441.png)

    - 사원 이름 : EMPLOYEE.NAME

    - 각 사원의 관리자 번호 : EMPLOYEE.MANAGER

    - 관리자 이름 : EMPLOYEE.NAME

    - 사원의 관리자 또한 사원임

      - 조인 대상 테이블이 두개 인데 동일한 테이블임

        - 물리적으로 1개임

        - 논리적으로 서로 다른 테이블이라고 생각하면 됨

          → 이외에는 다른 조인과 똑같음

      - 어떻게 서로 다른 테이블이라고 SQL로 할까?

        - 별명을 이용함

      ![20210327_095904](D:\Users\Brandon Jung\Desktop\20210327_095904.png)

    